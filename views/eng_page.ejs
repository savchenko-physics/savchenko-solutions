<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="content-language" content="en">
    <meta name="keywords" content="<%= __('meta.keywords') %>">
    <meta name="description" content="<%= __('meta.description') %>">
    <meta name="author" content="<%= __('meta.author') %>">
    <meta name="date" content="<%= __('meta.date') %>" scheme="YYYY-MM">
    <meta property="og:title" content="<%= __('title') %>">
    <meta property="og:image" content="img/logo.png">
    <meta property="og:description" content="<%= __('meta.ogDescription') %>">
    <meta name="yandex-verification" content="6cfda41f74038368">
    <title><%= __('title') %></title>
    <link rel="icon" href="/img/logo.png" type="image/png">
    <script src="/js/jquery-1.10.1.min.js"></script>
    
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/css/main_page.css">
</head>

<body class="container nbl-bg">
    <header class="header">
        <div class="d-flex justify-content-between align-items-center py-3 col">
            <div class="logo d-flex align-items-center">
                <img src="https://savchenkosolutions.com/img/book.png" alt="<%= __('title') %> Logo" style="width: 50px;">
                <div>
                    <p class="savchenko-color h1 mb-0" style="font-size: 1.75rem;"><%= __('title') %></p>
                    <p class="mb-0" style="color: #555; font-size: 0.9rem;"><%= __('motto') %></p>
                </div>
            </div>
            <div class="search position-relative">
                <input type="text" id="searchInput" class="form-control" placeholder="<%= __('menu.searchPlaceholder') %>">
                <div id="searchResults" class="search-results position-absolute bg-white border rounded shadow-sm" style="display: none; z-index: 1000; width: 100%;">
                    <ul class="list-unstyled mb-0"></ul>
                </div>
            </div>
            <div class="language d-flex align-items-center">
                <% if (lang === 'en') { %>
                    <span class="me-2"><strong><a href="/ru" class="text-dark text-decoration-none">EN</a></strong></span>
                <% } else { %>
                    <span class="me-2"><strong><a href="/en" class="text-dark text-decoration-none">RU</a></strong></span>
                <% } %>
                <% if (username) { %>
                    <a href="/user/<%= username %>">
                        <img src="/img/profile_images/<%= userId %>.png" alt="Profile Picture" class="rounded-circle" width="40">
                    </a>
                <% } else { %>
                    <a href="/login" class="btn btn-outline-primary rounded-pill shadow-sm"><%= __('menu.login') %></a>
                <% } %>
            </div>
        </div>
    </header>

    <main class="my-5">
        <h2 class="text-center my-5"><%= __('subtitle') %></h2>
        <div class="d-flex align-items-stretch">
            <div class="col-md-7">
                <div class="content shadow-sm br-10 p-4 h-100 bl-bg text-justify">
                    <p><%= __('description.intro') %></p>
                    <p><%= __('description.project') %> <%= __('description.team') %>. <%= __('description.moto') %> <%= __('description.contribute') %> <a href="/study-guide"><%= __('description.guide') %></a>.</p>
                </div>
            </div>
            <div class="col-md-5 d-flex align-items-stretch">
                <div class="video w-100 h-100" style="overflow: hidden;">
                    <iframe src="https://www.youtube.com/embed/d-x7Lk-mfTs" frameborder="0" allowfullscreen="" class="top-0 start-0 h-100 w-100" style="border: none; border-radius: 10px;">
                    </iframe>
                </div>
            </div>
        </div>
        <div class="d-flex justify-content-between align-items-stretch">
            <div class="col-3 mt-4 d-flex align-items-stretch">
                <div class="w-100" style="overflow: hidden;">
                    <img src="https://savchenkosolutions.com/img/team.png" alt="<%= __('description.coreTeam') %>" class="img-fluid" style="width: 100%; height: auto;">
                </div>
            </div>
            <div class="col-9 mt-4 d-flex align-items-stretch">
                <div class="content bg-light p-4 w-100 bl-bg shadow-sm br-10 text-justify">
                    <h3><%= __('description.acknowledgments') %></h3>
                    <p><%= __('description.deepestThanks') %></p>
                    <h4><%= __('description.coreTeam') %></h4>
                    <div class="core-team">
                        <a href="/user/astrosander/" style="font-size: 1.1rem;">Aliaksandr Melnichenka â€“ Founder &amp; CEO</a>
                        <a href="/user/Luisito/" style="font-size: 1.1rem;">Luis Daniel FernÃ¡ndez Quintana</a>
                        <a href="/user/stefannicov/" style="font-size: 1.1rem;">Stefan Nicov</a>
                        <a href="/user/ar4senN/" style="font-size: 1.1rem;">Arsen Almashkan</a>
                        <a href="/user/a.yersh/" style="font-size: 1.1rem;">Andrei Yersh</a>
                        <a href="/user/jepkinsss/" style="font-size: 1.1rem;">Artem Levko</a>
                        <a href="/user/diikann_/" style="font-size: 1.1rem;">Dzikan Mikita</a>
                        <a href="/about#team" style="font-size: 1.1rem;">See all...</a>
                    </div>
                </div>
            </div>
        </div>
    </main>
    <div id="edit-popup" class="" style="display: none;">
        <h3><%= __('popup.title') %></h3>
        <input type="text" id="problem-name" placeholder="<%= __('popup.placeholder') %>">
        <button id="submit-problem"><%= __('popup.submit') %></button>
        <button id="cancel-edit"><%= __('popup.cancel') %></button>
    </div>

    <div id="popup-overlay" class="" style="display: none;">
    </div>

    <section class="container my-5">
        <div class="row">
            <div class="col-md-8 bg-white br-10 shadow-sm" >
                <% chapters.forEach((chapter, chapterIndex)=> {
                    const hasContent = chapter.sections.some(section => section.problems.some(column => column.length >
                    0));
                    if (hasContent) { %>                    
                    <p class="h3 p-0 text-center my-4">
                        <span class="text-secondary"><%= __('chapter') %> <%= chapterIndex + 1 %></span>
                        <span class="savchenko-color font-weight-bold">
                            <%= chapter.title %>
                        </span>
                        <span>
                            <a href="#" class="edit-button savchenko-color" data-chapter="<%= chapterIndex + 1 %>">
                                <span class="upload-text"><%= __('upload') %></span>
                                <svg class="upload-icon" viewBox="0 0 24 24" width="16" height="16">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M17 8l-5-5-5 5M12 3v12"></path>
                                </svg>
                            </a>
                        </span>
                    </p>
                    
                    <div class="col-12 col-md-11 border-top mt-3">
                        <% chapter.sections.forEach((section, sectionIndex)=> {
                            const hasProblems = section.problems.some(column => column.length > 0);
                            if (hasProblems) { %>
                            <p class="mt-4 mb-2 font-weight-bold" id="<%= section.number %>">
                                Â§ <%= section.number %> <%= section.title %>
                            </p>

                            <div class="problems-grid">
                                <% const allProblems=section.problems.flat(); allProblems.forEach((problem)=> { %>
                                    <div class="problem-item">
                                        <a href="/<%= lang %>/<%= problem %>" class="problem-link">
                                            <%= problem %>
                                        </a>
                                    </div>
                                    <% }); %>
                            </div>
                            <% } }); %>
                    </div>
                    <% } }); %>
            </div>
            <div class="col-md-4">
                <div class="top-authors text-center br-10 shadow-sm">
                    <h3 class="text-center mb-4"><%= __('description.topAuthors') %></h3>
                    <table class="table table-hover mx-auto" style="width: auto;">
                        <thead class="thead-light">
                            <tr>
                                <th scope="col" style="width: 10%; opacity: 0.8;">#</th>
                                <th scope="col" style="width: 45%; opacity: 0.8;"><%= __('description.profile') %></th>
                                <th scope="col" style="width: 45%; opacity: 0.8;"><%= __('description.contributions') %></th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>ðŸ¥‡</td>
                                <td><a href="/user/Luisito" class="text-dark text-decoration-none">Luisito</a></td>
                                <td>152</td>
                            </tr>
                            <tr>
                                <td>ðŸ¥ˆ</td>
                                <td><a href="/user/ar4senN" class="text-dark text-decoration-none">ar4senN</a></td>
                                <td>127</td>
                            </tr>
                            <tr>
                                <td>ðŸ¥‰</td>
                                <td><a href="/user/diikann_" class="text-dark text-decoration-none">diikann_</a></td>
                                <td>116</td>
                            </tr>
                            <tr>
                                <td>4</td>
                                <td><a href="/user/Ismail" class="text-dark text-decoration-none">Ismail</a></td>
                                <td>104</td>
                            </tr>
                            <tr>
                                <td>5</td>
                                <td><a href="/user/a.yersh" class="text-dark text-decoration-none">a.yersh</a></td>
                                <td>94</td>
                            </tr>
                            <tr>
                                <td>6</td>
                                <td><a href="/user/jepkinsss" class="text-dark text-decoration-none">jepkinsss</a></td>
                                <td>77</td>
                            </tr>
                            <tr>
                                <td>7</td>
                                <td><a href="/user/_chender_" class="text-dark text-decoration-none">_chender_</a></td>
                                <td>65</td>
                            </tr>
                            <tr>
                                <td>8</td>
                                <td><a href="/user/Sasha" class="text-dark text-decoration-none">Sasha</a></td>
                                <td>22</td>
                            </tr>
                            <tr>
                                <td>9</td>
                                <td><a href="/user/Artoghrul" class="text-dark text-decoration-none">Artoghrul</a></td>
                                <td>16</td>
                            </tr>
                            <tr>
                                <td>10</td>
                                <td><a href="/user/Nurbaqyt" class="text-dark text-decoration-none">Nurbaqyt</a></td>
                                <td>11</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="contributions text-center mt-3 bg-white br-10 p-4 shadow-sm">
                    <h3 class="text-center mb-4"><%= __('description.contributions2') %></h3>
                    <div class="contribution-history timeline">
                        <% recentContributions.forEach(contribution => { %>
                        <div class="timeline-item">
                            <div class="timeline-content nbl-bg">
                                <strong><%= contribution.version %></strong> 
                                <% if (lang === 'en') { %>
                                <span class="text-muted">
                                    <a href="/<%= lang %>/contributions/<%= contribution.id %>" class="text-primary text-decoration-none">
                                        <%= lang === 'en' ? 'edited' : 'Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð°' %>
                                    </a> 
                                    <span class="text-dark font-weight-bold"><%= contribution.editor %></span>
                                </span>
                                <% } else { %>
                                <span class="text-muted">
                                    <a href="/<%= lang %>/contributions/<%= contribution.id %>" class="text-primary text-decoration-none">
                                        <%= lang === 'en' ? 'edited' : 'Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð°' %>
                                    </a> 
                                    <span class="text-dark font-weight-bold"><%= contribution.editor %></span>
                                </span>
                                <% } %>
                                <span style="font-size: 0.8rem; color: #888;"><%= contribution.timestamp %></span>
                            </div>
                        </div>
                        <% }); %>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <style>
        .search-results {
            max-height: 200px; /* Limit the height of the results */
            overflow-y: auto; /* Add scroll if results exceed max height */
            font-size: 0.85rem; /* Smaller font size for search results */
        }
        .search-results ul {
            padding: 0;
            margin: 0;
        }
        .search-results li {
            padding: 8px 12px;
            cursor: pointer;
        }
        .search-results li:hover {
            background-color: #f1f1f1;
        }
    </style>
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.3/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script>
        const searchInput = document.getElementById("searchInput");
        const searchResults = document.getElementById("searchResults");
        const searchResultsList = document.querySelector("#searchResults ul");

        searchInput.addEventListener("input", async () => {
            const query = searchInput.value.trim();

            if (query.length === 0) {
                searchResults.style.display = "none";
                searchResultsList.innerHTML = "";
                return;
            }

            try {
                const response = await fetch(`/search?q=${encodeURIComponent(query)}`);
                const data = await response.json();

                if (data.results.length > 0) {
                    const limitedResults = data.results.slice(0, 5);
                    searchResultsList.innerHTML = limitedResults.map((result, index) => `
                        <li id="cdx-menu-item-${index}" role="option" class="cdx-menu-item cdx-menu-item--enabled">
                            <a href="${result.relativePath}" class="cdx-menu-item__content text-dark text-decoration-none">
                                <span class="cdx-menu-item__text">
                                    <span class="cdx-search-result-title"><bdi>${result.name}</bdi></span>
                                    <span class="cdx-menu-item__text__description"><bdi>${result.snippet}</bdi></span>
                                </span>
                            </a>
                        </li>
                    `).join("");
                    searchResults.style.display = "block";
                } else {
                    searchResultsList.innerHTML = `
                        <li class="cdx-menu-item cdx-menu-item--enabled">
                            <span class="cdx-menu-item__content">
                                <span class="cdx-menu-item__text">No results found.</span>
                            </span>
                        </li>
                    `;
                }
            } catch (error) {
                console.error('Error fetching search results:', error);
            }
        });
    </script>
        <!-- Add these elements somewhere in your HTML body -->

        <script>
            document.addEventListener("DOMContentLoaded", () => {
                // Add preload class to body initially
                document.body.classList.add('preload');
                
                // Remove preload class after a delay
                setTimeout(() => {
                    document.body.classList.remove('preload');
                }, 500);
    
                const popup = document.getElementById("edit-popup");
                const overlay = document.getElementById("popup-overlay");
                const problemInput = document.getElementById("problem-name");
                let currentChapter;
    
                function showPopup() {
                    popup.style.display = "block";
                    overlay.style.display = "block";
                    // Force reflow
                    popup.offsetHeight;
                    overlay.offsetHeight;
                    // Add active class to trigger animations
                    popup.classList.add("active");
                    overlay.classList.add("active");
                }
    
                function hidePopup() {
                    popup.classList.remove("active");
                    overlay.classList.remove("active");
                    // Wait for animations to complete before hiding elements
                    setTimeout(() => {
                        popup.style.display = "none";
                        overlay.style.display = "none";
                        problemInput.value = "";
                    }, 300);
                }
    
                document.querySelectorAll(".edit-button").forEach(button => {
                    button.addEventListener("click", (event) => {
                        event.preventDefault();
                        currentChapter = button.dataset.chapter;
                        showPopup();
                    });
                });
    
                document.getElementById("cancel-edit").addEventListener("click", () => {
                    hidePopup();
                });
    
                document.getElementById("submit-problem").addEventListener("click", () => {
                    const problemName = problemInput.value.trim();
                    if (problemName) {
                        fetch("/create-problem", {
                            method: "POST",
                            headers: { "Content-Type": "application/json" },
                            body: JSON.stringify({ 
                                problemName, 
                                chapter: currentChapter,
                                lang: 'en'
                            })
                        })
                            .then(response => response.json())
                            .then(data => {
                                if (data.redirectUrl) {
                                    window.location.href = data.redirectUrl;
                                } else {
                                    alert(data.message);
                                    hidePopup();
                                }
                            })
                            .catch(error => {
                                console.error("Error:", error);
                                alert("An error occurred. Please try again.");
                            });
                    } else {
                        alert('Please enter a valid problem name.');
                    }
                });
            });
        </script>
    
</body>

</html>