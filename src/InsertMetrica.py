import csv
import psycopg2
import os
import time

# Database connection credentials from environment variables
HOST = os.getenv("DB_HOST")
PORT = os.getenv("DB_PORT")
DATABASE = os.getenv("DB_DATABASE")
USER = os.getenv("DB_USER")
PASSWORD = os.getenv("DB_PASSWORD")

# Path to your CSV files directory
CSV_DIR_PATH = r"\metrica"

already_processed = ['en_1.1.1.csv', 'en_1.1.10.csv', 'en_1.1.11.csv', 'en_1.1.12.csv', 'en_1.1.13.csv', 'en_1.1.14.csv', 'en_1.1.15.csv', 'en_1.1.16.csv', 'en_1.1.17.csv', 'en_1.1.18.csv', 'en_1.1.19.csv', 'en_1.1.2.csv', 'en_1.1.20.csv', 'en_1.1.21.csv', 'en_1.1.22.csv', 'en_1.1.23.csv', 'en_1.1.3.csv', 'en_1.1.4.csv', 'en_1.1.5.csv', 'en_1.1.6.csv', 'en_1.1.7.csv', 'en_1.1.8.csv', 'en_1.1.9.csv', 'en_1.2.1.csv', 'en_1.2.10.csv', 'en_1.2.11.csv', 'en_1.2.12.csv', 'en_1.2.13.csv', 'en_1.2.14.csv', 'en_1.2.19.csv', 'en_1.2.2.csv', 'en_1.2.20.csv', 'en_1.2.21.csv', 'en_1.2.3.csv', 'en_1.2.4.csv', 'en_1.2.5.csv', 'en_1.2.6.csv', 'en_1.2.7.csv', 'en_1.2.8.csv', 'en_1.2.9.csv', 'en_1.3.1.csv', 'en_1.3.10.csv', 'en_1.3.11.csv', 'en_1.3.12.csv', 'en_1.3.13.csv', 'en_1.3.14.csv', 'en_1.3.15.csv', 'en_1.3.16.csv', 'en_1.3.17.csv', 'en_1.3.18.csv', 'en_1.3.19.csv', 'en_1.3.2.csv', 'en_1.3.20.csv', 'en_1.3.21.csv', 'en_1.3.22.csv', 'en_1.3.23.csv', 'en_1.3.24.csv', 'en_1.3.25.csv', 'en_1.3.26.csv', 'en_1.3.27.csv', 'en_1.3.28.csv', 'en_1.3.29.csv', 'en_1.3.3.csv', 'en_1.3.30.csv', 'en_1.3.4.csv', 'en_1.3.5.csv', 'en_1.3.6.csv', 'en_1.3.7.csv', 'en_1.3.8.csv', 'en_1.3.9.csv', 'en_1.4.1.csv', 'en_1.4.10.csv', 'en_1.4.11.csv', 'en_1.4.12.csv', 'en_1.4.13.csv', 'en_1.4.14.csv', 'en_1.4.15.csv', 'en_1.4.16.csv', 'en_1.4.17.csv', 'en_1.4.18.csv', 'en_1.4.2.csv', 'en_1.4.3.csv', 'en_1.4.4.csv', 'en_1.4.5.csv', 'en_1.4.7.csv', 'en_1.4.8.csv', 'en_1.4.9.csv', 'en_1.5.1.csv', 'en_1.5.10.csv', 'en_1.5.11.csv', 'en_1.5.12.csv', 'en_1.5.13.csv', 'en_1.5.14.csv', 'en_1.5.15.csv', 'en_1.5.16.csv', 'en_1.5.17.csv', 'en_1.5.18.csv', 'en_1.5.19.csv', 'en_1.5.2.csv', 'en_1.5.20.csv', 'en_1.5.3.csv', 'en_1.5.4.csv', 'en_1.5.5.csv', 'en_1.5.6.csv', 'en_1.5.7.csv', 'en_1.5.8.csv', 'en_1.5.9.csv', 'en_10.1.15.csv', 'en_10.2.11.csv', 'en_10.2.12.csv', 'en_10.2.8.csv', 'en_11.2.2.csv', 'en_11.5.11.csv', 'en_12.1.4.csv', 'en_13.2.11.csv', 'en_13.2.14.csv', 'en_2.1.1.csv', 'en_2.1.10.csv', 'en_2.1.11.csv', 'en_2.1.12.csv', 'en_2.1.13.csv', 'en_2.1.14.csv', 'en_2.1.15.csv', 'en_2.1.16.csv', 'en_2.1.17.csv', 'en_2.1.18.csv', 'en_2.1.19.csv', 'en_2.1.2.csv', 'en_2.1.20.csv', 'en_2.1.21.csv', 'en_2.1.22.csv', 'en_2.1.23.csv', 'en_2.1.24.csv', 'en_2.1.25.csv', 'en_2.1.26.csv', 'en_2.1.28.csv', 'en_2.1.29.csv', 'en_2.1.3.csv', 'en_2.1.30.csv', 'en_2.1.31.csv', 'en_2.1.32.csv', 'en_2.1.33.csv', 'en_2.1.34.csv', 'en_2.1.35.csv', 'en_2.1.36.csv', 'en_2.1.37.csv', 'en_2.1.38.csv', 'en_2.1.39.csv', 'en_2.1.4.csv', 'en_2.1.40.csv', 'en_2.1.41.csv', 'en_2.1.42.csv', 'en_2.1.44.csv', 'en_2.1.45.csv', 'en_2.1.46.csv', 'en_2.1.47.csv', 'en_2.1.48.csv', 'en_2.1.49.csv', 'en_2.1.5.csv', 'en_2.1.6.csv', 'en_2.1.7.csv', 'en_2.1.8.csv', 'en_2.1.9.csv', 'en_2.2.16.csv', 'en_2.2.23.csv', 'en_2.2.24.csv', 'en_2.2.29.csv', 'en_2.2.34.csv', 'en_2.2.37.csv', 'en_2.2.38.csv', 'en_2.2.39.csv', 'en_2.2.41.csv', 'en_2.2.42.csv', 'en_2.2.44.csv', 'en_2.3.30.csv', 'en_2.3.35.csv', 'en_2.3.36.csv', 'en_2.3.38.csv', 'en_2.3.39.csv', 'en_2.3.40.csv', 'en_2.3.41.csv', 'en_2.3.44.csv', 'en_2.3.45.csv', 'en_2.3.46.csv', 'en_2.3.48.csv', 'en_2.3.49.csv', 'en_2.4.1.csv', 'en_2.4.12.csv', 'en_2.4.16.csv', 'en_2.4.17.csv', 'en_2.4.20.csv', 'en_2.4.34.csv', 'en_2.4.35.csv', 'en_2.4.9.csv', 'en_2.5.17.csv', 'en_2.5.18.csv', 'en_2.5.35.csv', 'en_2.5.36.csv', 'en_2.5.38.csv', 'en_2.5.9.csv', 'en_2.6.14.csv', 'en_2.6.33.csv', 'en_2.6.36.csv', 'en_2.6.37.csv', 'en_2.6.41.csv', 'en_2.6.42.csv', 'en_2.6.43.csv', 'en_2.6.45.csv', 'en_2.6.46.csv', 'en_2.6.48.csv', 'en_2.6.52.csv', 'en_2.7.19.csv', 'en_2.7.20.csv', 'en_2.7.27.csv', 'en_2.7.41.csv', 'en_2.7.42.csv', 'en_2.7.44.csv', 'en_2.7.6.csv', 'en_2.8.1.csv', 'en_2.8.11.csv', 'en_2.8.13.csv', 'en_2.8.14.csv', 'en_2.8.17.csv', 'en_2.8.25.csv', 'en_2.8.34.csv', 'en_2.8.37.csv', 'en_2.8.4.csv', 'en_2.8.43.csv', 'en_3.1.1.csv', 'en_3.1.10.csv', 'en_3.1.11.csv', 'en_3.1.12.csv', 'en_3.1.15.csv', 'en_3.1.16.csv', 'en_3.1.17.csv', 'en_3.1.2.csv', 'en_3.1.3.csv', 'en_3.1.4.csv', 'en_3.1.5.csv', 'en_3.1.6.csv', 'en_3.1.7.csv', 'en_3.1.8.csv', 'en_3.1.9.csv', 'en_3.2.1.csv', 'en_3.2.10.csv', 'en_3.2.11.csv', 'en_3.2.12.csv', 'en_3.2.13.csv', 'en_3.2.14.csv', 'en_3.2.16.csv', 'en_3.2.17.csv', 'en_3.2.2.csv', 'en_3.2.3.csv', 'en_3.2.4.csv', 'en_3.2.5.csv', 'en_3.2.6.csv', 'en_3.2.7.csv', 'en_3.2.8.csv', 'en_3.2.9.csv', 'en_3.3.3.csv', 'en_3.3.8.csv', 'en_4.1.12.csv', 'en_4.1.13.csv', 'en_4.1.22.csv', 'en_4.2.11.csv', 'en_4.2.12.csv', 'en_4.2.13.csv', 'en_4.2.14.csv', 'en_4.2.26.csv', 'en_4.2.6.csv', 'en_4.2.7.csv', 'en_5.2.9.csv', 'en_5.3.1.csv', 'en_5.3.2.csv', 'en_5.3.3.csv', 'en_5.4.16.csv', 'en_5.5.16.csv', 'en_5.5.3.csv', 'en_5.6.22.csv', 'en_5.6.26.csv', 'en_5.6.31.csv', 'en_5.9.10.csv', 'en_5.9.2.csv', 'en_5.9.3.csv', 'en_5.9.5.csv', 'en_6.2.10.csv', 'en_6.2.11.csv', 'en_6.2.12.csv', 'en_6.2.13.csv', 'en_6.4.7.csv', 'en_6.5.1.csv', 'en_6.5.2.csv', 'en_7.1.12.csv', 'en_7.1.17.csv', 'en_7.1.22.csv', 'en_7.1.23.csv', 'en_7.1.3.csv', 'en_7.1.6.csv', 'en_7.3.9.csv', 'en_8.3.15.csv', 'en_9.1.1.csv', 'en_9.1.10.csv', 'en_9.1.11.csv', 'en_9.1.12.csv', 'en_9.1.13.csv', 'en_9.1.14.csv', 'en_9.1.15.csv', 'en_9.1.2.csv', 'en_9.1.3.csv', 'en_9.1.4.csv', 'en_9.1.5.csv', 'en_9.1.6.csv', 'en_9.1.7.csv', 'en_9.1.8.csv', 'en_9.1.9.csv', 'en_9.2.1.csv', 'en_9.2.10.csv', 'en_9.2.11.csv', 'en_9.2.12.csv', 'en_9.2.13.csv', 'en_9.2.14.csv', 'en_9.2.15.csv', 'en_9.2.16.csv', 'en_9.2.17.csv', 'en_9.2.2.csv', 'en_9.2.3.csv', 'en_9.2.4.csv', 'en_9.2.5.csv', 'en_9.2.6.csv', 'en_9.2.7.csv', 'en_9.2.8.csv', 'en_9.2.9.csv', 'en_9.3.2.csv', 'ru_1.1.1.csv', 'ru_1.1.10.csv', 'ru_1.1.11.csv', 'ru_1.1.12.csv', 'ru_1.1.13.csv', 'ru_1.1.14.csv', 'ru_1.1.15.csv', 'ru_1.1.16.csv', 'ru_1.1.17.csv', 'ru_1.1.18.csv', 'ru_1.1.19.csv', 'ru_1.1.2.csv', 'ru_1.1.20.csv', 'ru_1.1.21.csv', 'ru_1.1.22.csv', 'ru_1.1.23.csv', 'ru_1.1.3.csv', 'ru_1.1.4.csv', 'ru_1.1.5.csv', 'ru_1.1.6.csv', 'ru_1.1.7.csv', 'ru_1.1.8.csv', 'ru_1.1.9.csv', 'ru_1.2.1.csv', 'ru_1.2.10.csv', 'ru_1.2.11.csv', 'ru_1.2.12.csv', 'ru_1.2.13.csv', 'ru_1.2.14.csv', 'ru_1.2.2.csv', 'ru_1.2.20.csv', 'ru_1.2.21.csv', 'ru_1.2.3.csv', 'ru_1.2.4.csv', 'ru_1.2.5.csv', 'ru_1.2.6.csv', 'ru_1.2.7.csv', 'ru_1.2.8.csv', 'ru_1.2.9.csv', 'ru_1.3.1.csv', 'ru_1.3.10.csv', 'ru_1.3.11.csv', 'ru_1.3.12.csv', 'ru_1.3.13.csv', 'ru_1.3.14.csv', 'ru_1.3.15.csv', 'ru_1.3.16.csv', 'ru_1.3.17.csv', 'ru_1.3.18.csv', 'ru_1.3.19.csv', 'ru_1.3.2.csv', 'ru_1.3.20.csv', 'ru_1.3.21.csv', 'ru_1.3.22.csv', 'ru_1.3.23.csv', 'ru_1.3.24.csv', 'ru_1.3.25.csv', 'ru_1.3.26.csv', 'ru_1.3.27.csv', 'ru_1.3.28.csv', 'ru_1.3.29.csv', 'ru_1.3.3.csv', 'ru_1.3.30.csv', 'ru_1.3.4.csv', 'ru_1.3.5.csv', 'ru_1.3.6.csv', 'ru_1.3.7.csv', 'ru_1.3.8.csv', 'ru_1.3.9.csv', 'ru_1.4.1.csv', 'ru_1.4.10.csv', 'ru_1.4.11.csv', 'ru_1.4.12.csv', 'ru_1.4.13.csv', 'ru_1.4.14.csv', 'ru_1.4.15.csv', 'ru_1.4.16.csv', 'ru_1.4.17.csv', 'ru_1.4.18.csv', 'ru_1.4.2.csv', 'ru_1.4.3.csv', 'ru_1.4.4.csv', 'ru_1.4.5.csv', 'ru_1.4.6.csv', 'ru_1.4.7.csv', 'ru_1.4.8.csv', 'ru_1.4.9.csv', 'ru_1.5.1.csv', 'ru_1.5.10.csv', 'ru_1.5.11.csv', 'ru_1.5.12.csv', 'ru_1.5.13.csv', 'ru_1.5.14.csv', 'ru_1.5.15.csv', 'ru_1.5.16.csv', 'ru_1.5.17.csv', 'ru_1.5.18.csv', 'ru_1.5.19.csv', 'ru_1.5.2.csv', 'ru_1.5.20.csv', 'ru_1.5.3.csv', 'ru_1.5.4.csv', 'ru_1.5.5.csv', 'ru_1.5.6.csv', 'ru_1.5.7.csv', 'ru_1.5.8.csv', 'ru_1.5.9.csv', 'ru_10.1.20.csv', 'ru_10.1.21.csv', 'ru_10.1.23.csv', 'ru_10.2.2.csv', 'ru_10.2.4.csv', 'ru_10.2.5.csv', 'ru_11.1.10.csv', 'ru_11.1.11.csv', 'ru_11.1.12.csv', 'ru_11.1.13.csv', 'ru_11.1.14.csv', 'ru_11.1.15.csv', 'ru_11.1.16.csv', 'ru_11.1.17.csv', 'ru_11.1.18.csv', 'ru_11.1.19.csv', 'ru_11.1.2.csv', 'ru_11.1.20.csv', 'ru_11.1.21.csv', 'ru_11.1.22.csv', 'ru_11.1.23.csv', 'ru_11.1.24.csv', 'ru_11.1.25.csv', 'ru_11.1.26.csv', 'ru_11.1.3.csv', 'ru_11.1.31.csv', 'ru_11.1.4.csv', 'ru_11.1.5.csv', 'ru_11.1.6.csv', 'ru_11.1.7.csv', 'ru_11.1.8.csv', 'ru_11.1.9.csv', 'ru_11.2.15.csv', 'ru_13.2.20.csv', 'ru_13.4.18.csv', 'ru_2.1.1.csv', 'ru_2.1.10.csv', 'ru_2.1.11.csv', 'ru_2.1.12.csv', 'ru_2.1.13.csv', 'ru_2.1.14.csv', 'ru_2.1.15.csv', 'ru_2.1.16.csv', 'ru_2.1.17.csv', 'ru_2.1.18.csv', 'ru_2.1.19.csv', 'ru_2.1.2.csv', 'ru_2.1.20.csv', 'ru_2.1.21.csv', 'ru_2.1.22.csv', 'ru_2.1.23.csv', 'ru_2.1.24.csv', 'ru_2.1.25.csv', 'ru_2.1.26.csv', 'ru_2.1.27.csv', 'ru_2.1.28.csv', 'ru_2.1.29.csv', 'ru_2.1.3.csv', 'ru_2.1.30.csv', 'ru_2.1.31.csv', 'ru_2.1.32.csv', 'ru_2.1.33.csv', 'ru_2.1.34.csv', 'ru_2.1.35.csv', 'ru_2.1.36.csv', 'ru_2.1.37.csv', 'ru_2.1.38.csv', 'ru_2.1.39.csv', 'ru_2.1.4.csv', 'ru_2.1.40.csv', 'ru_2.1.41.csv', 'ru_2.1.42.csv', 'ru_2.1.43.csv', 'ru_2.1.44.csv', 'ru_2.1.45.csv', 'ru_2.1.46.csv', 'ru_2.1.47.csv', 'ru_2.1.48.csv', 'ru_2.1.49.csv', 'ru_2.1.5.csv', 'ru_2.1.50.csv', 'ru_2.1.51.csv', 'ru_2.1.52.csv', 'ru_2.1.53.csv', 'ru_2.1.54.csv', 'ru_2.1.55.csv', 'ru_2.1.56.csv', 'ru_2.1.57.csv', 'ru_2.1.58.csv', 'ru_2.1.59.csv', 'ru_2.1.6.csv', 'ru_2.1.60.csv', 'ru_2.1.61.csv', 'ru_2.1.62.csv', 'ru_2.1.63.csv', 'ru_2.1.64.csv', 'ru_2.1.65.csv', 'ru_2.1.66.csv', 'ru_2.1.67.csv', 'ru_2.1.7.csv', 'ru_2.1.8.csv', 'ru_2.1.9.csv', 'ru_2.2.1.csv', 'ru_2.2.10.csv', 'ru_2.2.11.csv', 'ru_2.2.12.csv', 'ru_2.2.13.csv', 'ru_2.2.14.csv', 'ru_2.2.15.csv', 'ru_2.2.17.csv', 'ru_2.2.18.csv', 'ru_2.2.19.csv', 'ru_2.2.2.csv', 'ru_2.2.20.csv', 'ru_2.2.21.csv', 'ru_2.2.22.csv', 'ru_2.2.24.csv', 'ru_2.2.25.csv', 'ru_2.2.26.csv', 'ru_2.2.27.csv', 'ru_2.2.28.csv', 'ru_2.2.29.csv', 'ru_2.2.3.csv', 'ru_2.2.31.csv', 'ru_2.2.32.csv', 'ru_2.2.33.csv', 'ru_2.2.35.csv', 'ru_2.2.36.csv', 'ru_2.2.4.csv', 'ru_2.2.43.csv', 'ru_2.2.46.csv', 'ru_2.2.47.csv', 'ru_2.2.5.csv', 'ru_2.2.6.csv', 'ru_2.2.7.csv', 'ru_2.2.8.csv', 'ru_2.2.9.csv', 'ru_2.3.1.csv', 'ru_2.3.10.csv', 'ru_2.3.11.csv', 'ru_2.3.12.csv', 'ru_2.3.13.csv', 'ru_2.3.14.csv', 'ru_2.3.15.csv', 'ru_2.3.16.csv', 'ru_2.3.17.csv', 'ru_2.3.18.csv', 'ru_2.3.19.csv', 'ru_2.3.2.csv', 'ru_2.3.20.csv', 'ru_2.3.21.csv', 'ru_2.3.23.csv', 'ru_2.3.25.csv', 'ru_2.3.26.csv', 'ru_2.3.27.csv', 'ru_2.3.28.csv', 'ru_2.3.29.csv', 'ru_2.3.3.csv', 'ru_2.3.32.csv', 'ru_2.3.33.csv', 'ru_2.3.34.csv', 'ru_2.3.4.csv', 'ru_2.3.42.csv', 'ru_2.3.47.csv', 'ru_2.3.48.csv', 'ru_2.3.5.csv', 'ru_2.3.6.csv', 'ru_2.3.7.csv', 'ru_2.3.8.csv', 'ru_2.3.9.csv', 'ru_2.4.10.csv', 'ru_2.4.11.csv', 'ru_2.4.12.csv', 'ru_2.4.13.csv', 'ru_2.4.16.csv', 'ru_2.4.18.csv', 'ru_2.4.2.csv', 'ru_2.4.3.csv', 'ru_2.4.31.csv', 'ru_2.4.4.csv', 'ru_2.4.42.csv', 'ru_2.4.43.csv', 'ru_2.4.7.csv', 'ru_2.4.8.csv', 'ru_2.5.1.csv', 'ru_2.5.12.csv', 'ru_2.5.19.csv', 'ru_2.5.2.csv', 'ru_2.5.21.csv', 'ru_2.5.23.csv', 'ru_2.5.25.csv', 'ru_2.5.3.csv', 'ru_2.5.34.csv', 'ru_2.5.37.csv', 'ru_2.5.39.csv', 'ru_2.6.16.csv', 'ru_2.6.18.csv', 'ru_2.6.19.csv', 'ru_2.6.20.csv', 'ru_2.6.21.csv', 'ru_2.6.22.csv', 'ru_2.6.23.csv', 'ru_2.6.24.csv', 'ru_2.6.25.csv', 'ru_2.6.26.csv', 'ru_2.6.27.csv', 'ru_2.6.28.csv', 'ru_2.6.29.csv', 'ru_2.6.3.csv', 'ru_2.6.30.csv', 'ru_2.6.31.csv', 'ru_2.6.32.csv', 'ru_2.6.33.csv', 'ru_2.6.34.csv', 'ru_2.6.38.csv', 'ru_2.6.39.csv', 'ru_2.6.40.csv', 'ru_2.6.47.csv', 'ru_2.6.49.csv', 'ru_2.6.50.csv', 'ru_2.6.53.csv', 'ru_2.7.1.csv', 'ru_2.7.10.csv', 'ru_2.7.11.csv', 'ru_2.7.12.csv', 'ru_2.7.13.csv', 'ru_2.7.14.csv', 'ru_2.7.15.csv', 'ru_2.7.16.csv', 'ru_2.7.17.csv', 'ru_2.7.18.csv', 'ru_2.7.19.csv', 'ru_2.7.2.csv', 'ru_2.7.20.csv', 'ru_2.7.21.csv', 'ru_2.7.22.csv', 'ru_2.7.23.csv', 'ru_2.7.24.csv', 'ru_2.7.26.csv', 'ru_2.7.27.csv', 'ru_2.7.28.csv', 'ru_2.7.29.csv', 'ru_2.7.3.csv', 'ru_2.7.30.csv', 'ru_2.7.31.csv', 'ru_2.7.33.csv', 'ru_2.7.34.csv', 'ru_2.7.35.csv', 'ru_2.7.36.csv', 'ru_2.7.4.csv', 'ru_2.7.40.csv', 'ru_2.7.41.csv', 'ru_2.7.42.csv', 'ru_2.7.43.csv', 'ru_2.7.44.csv', 'ru_2.7.45.csv', 'ru_2.7.46.csv', 'ru_2.7.47.csv', 'ru_2.7.48.csv', 'ru_2.7.5.csv', 'ru_2.7.6.csv', 'ru_2.7.7.csv', 'ru_2.7.9.csv', 'ru_2.8.1.csv', 'ru_2.8.10.csv', 'ru_2.8.11.csv', 'ru_2.8.2.csv', 'ru_2.8.25.csv', 'ru_2.8.3.csv', 'ru_2.8.6.csv', 'ru_2.8.8.csv', 'ru_2.8.9.csv', 'ru_3.1.1.csv', 'ru_3.1.10.csv', 'ru_3.1.11.csv', 'ru_3.1.12.csv', 'ru_3.1.15.csv', 'ru_3.1.16.csv', 'ru_3.1.17.csv', 'ru_3.1.2.csv', 'ru_3.1.3.csv', 'ru_3.1.4.csv', 'ru_3.1.5.csv', 'ru_3.1.6.csv', 'ru_3.1.7.csv', 'ru_3.1.8.csv', 'ru_3.1.9.csv', 'ru_3.2.1.csv', 'ru_3.2.10.csv', 'ru_3.2.11.csv', 'ru_3.2.12.csv', 'ru_3.2.13.csv', 'ru_3.2.14.csv', 'ru_3.2.16.csv', 'ru_3.2.17.csv', 'ru_3.2.18.csv', 'ru_3.2.19.csv', 'ru_3.2.2.csv', 'ru_3.2.20.csv', 'ru_3.2.21.csv', 'ru_3.2.22.csv', 'ru_3.2.23.csv', 'ru_3.2.24.csv', 'ru_3.2.25.csv', 'ru_3.2.27.csv', 'ru_3.2.28.csv', 'ru_3.2.29.csv', 'ru_3.2.3.csv', 'ru_3.2.30.csv', 'ru_3.2.31.csv', 'ru_3.2.33.csv', 'ru_3.2.34.csv', 'ru_3.2.35.csv', 'ru_3.2.37.csv', 'ru_3.2.4.csv', 'ru_3.2.5.csv', 'ru_3.2.6.csv', 'ru_3.2.7.csv', 'ru_3.2.8.csv', 'ru_3.2.9.csv', 'ru_3.3.1.csv', 'ru_3.3.10.csv', 'ru_3.3.11.csv', 'ru_3.3.15.csv', 'ru_3.3.19.csv', 'ru_3.3.36.csv', 'ru_3.3.4.csv', 'ru_3.3.5.csv', 'ru_3.3.6.csv', 'ru_3.3.7.csv', 'ru_3.3.8.csv', 'ru_3.5.11.csv', 'ru_4.1.14.csv', 'ru_4.1.17.csv', 'ru_4.1.2.csv', 'ru_4.1.22.csv', 'ru_4.1.3.csv', 'ru_4.1.4.csv', 'ru_4.1.5.csv', 'ru_4.1.6.csv', 'ru_4.1.8.csv', 'ru_4.3.12.csv', 'ru_4.3.4.csv', 'ru_4.4.5.csv', 'ru_4.5.10.csv', 'ru_4.5.14.csv', 'ru_4.6.16.csv', 'ru_4.6.17.csv', 'ru_5.1.1.csv', 'ru_5.1.11.csv', 'ru_5.1.3.csv', 'ru_5.1.4.csv', 'ru_5.1.5.csv', 'ru_5.1.6.csv', 'ru_5.1.7.csv', 'ru_5.1.8.csv', 'ru_5.1.9.csv', 'ru_5.10.1.csv', 'ru_5.10.14.csv', 'ru_5.10.2.csv', 'ru_5.10.20.csv', 'ru_5.10.21.csv', 'ru_5.10.22.csv', 'ru_5.10.23.csv', 'ru_5.10.26.csv', 'ru_5.10.27.csv', 'ru_5.10.28.csv', 'ru_5.10.29.csv', 'ru_5.10.30.csv', 'ru_5.10.31.csv', 'ru_5.10.32.csv', 'ru_5.10.33.csv', 'ru_5.10.34.csv', 'ru_5.10.35.csv', 'ru_5.10.5.csv', 'ru_5.10.6.csv', 'ru_5.10.7.csv', 'ru_5.10.8.csv', 'ru_5.11.1.csv', 'ru_5.11.10.csv', 'ru_5.11.11.csv', 'ru_5.11.12.csv', 'ru_5.11.2.csv', 'ru_5.11.4.csv', 'ru_5.11.5.csv', 'ru_5.11.6.csv', 'ru_5.11.7.csv', 'ru_5.11.8.csv', 'ru_5.11.9.csv', 'ru_5.2.1.csv', 'ru_5.2.10.csv', 'ru_5.2.12.csv', 'ru_5.2.13.csv', 'ru_5.2.15.csv', 'ru_5.2.17.csv', 'ru_5.2.2.csv', 'ru_5.2.3.csv', 'ru_5.2.4.csv', 'ru_5.2.5.csv', 'ru_5.2.6.csv', 'ru_5.2.8.csv', 'ru_5.3.1.csv', 'ru_5.3.14.csv', 'ru_5.3.2.csv', 'ru_5.3.3.csv', 'ru_5.3.4.csv', 'ru_5.3.5.csv', 'ru_5.3.6.csv', 'ru_5.4.1.csv', 'ru_5.4.11.csv', 'ru_5.4.12.csv', 'ru_5.4.13.csv', 'ru_5.4.14.csv', 'ru_5.4.15.csv', 'ru_5.4.2.csv', 'ru_5.4.3.csv', 'ru_5.4.4.csv', 'ru_5.4.5.csv', 'ru_5.4.6.csv', 'ru_5.4.7.csv', 'ru_5.5.10.csv', 'ru_5.5.11.csv', 'ru_5.5.12.csv', 'ru_5.5.13.csv', 'ru_5.5.15.csv', 'ru_5.5.18.csv', 'ru_5.5.19.csv', 'ru_5.5.2.csv', 'ru_5.5.20.csv', 'ru_5.5.21.csv', 'ru_5.5.22.csv', 'ru_5.5.23.csv', 'ru_5.5.24.csv', 'ru_5.5.25.csv', 'ru_5.5.28.csv', 'ru_5.5.30.csv', 'ru_5.5.32.csv', 'ru_5.5.34.csv', 'ru_5.5.35.csv', 'ru_5.5.36.csv', 'ru_5.5.4.csv', 'ru_5.5.6.csv', 'ru_5.5.7.csv', 'ru_5.5.8.csv', 'ru_5.5.9.csv', 'ru_5.6.22.csv', 'ru_5.6.28.csv', 'ru_5.6.30.csv', 'ru_5.9.18.csv', 'ru_5.9.24.csv', 'ru_6.1.1.csv', 'ru_6.1.10.csv', 'ru_6.1.11.csv', 'ru_6.1.12.csv', 'ru_6.1.13.csv', 'ru_6.1.14.csv', 'ru_6.1.15.csv', 'ru_6.1.16.csv', 'ru_6.1.17.csv', 'ru_6.1.18.csv', 'ru_6.1.19.csv', 'ru_6.1.2.csv', 'ru_6.1.21.csv', 'ru_6.1.3.csv', 'ru_6.1.4.csv', 'ru_6.1.5.csv', 'ru_6.1.6.csv', 'ru_6.1.7.csv', 'ru_6.1.8.csv', 'ru_6.1.9.csv', 'ru_6.3.11.csv', 'ru_6.3.19.csv', 'ru_6.3.23.csv', 'ru_6.3.32.csv', 'ru_6.4.12.csv', 'ru_6.5.10.csv', 'ru_6.5.15.csv', 'ru_6.5.24.csv', 'ru_6.5.29.csv', 'ru_6.5.9.csv', 'ru_6.6.20.csv', 'ru_6.6.21.csv', 'ru_6.6.25.csv', 'ru_7.1.10.csv', 'ru_7.1.24.csv', 'ru_7.4.22.csv', 'ru_7.4.23.csv', 'ru_7.4.8.csv', 'ru_8.1.1.csv', 'ru_8.1.10.csv', 'ru_8.1.12.csv', 'ru_8.1.14.csv', 'ru_8.1.15.csv', 'ru_8.1.19.csv', 'ru_8.1.2.csv']

def main():
    # Connect to PostgreSQL
    conn = psycopg2.connect(
        host=HOST,
        port=PORT,
        dbname=DATABASE,
        user=USER,
        password=PASSWORD
    )
    cursor = conn.cursor()

    # Iterate through all CSV files in the directory
    for filename in os.listdir(CSV_DIR_PATH):
        if filename.endswith('.csv') and filename not in already_processed and "en" not in filename:
            start_time = time.time()
            print(filename)

            # Extract LANGUAGE and PROBLEM_NAME from the filename
            LANGUAGE, PROBLEM_NAME = filename.split('_')[0], '_'.join(filename.split('_')[1:]).replace('.csv', '')
        
            CSV_FILE_PATH = os.path.join(CSV_DIR_PATH, filename)

            with open(CSV_FILE_PATH, mode='r', encoding='utf-8') as f:
                reader = csv.reader(f, delimiter=',')
                
                # Skip the header row (Период,Value,)
                next(reader, None)
                
                for row in reader:
                    # Handle empty lines or trailing commas
                    if not row or len(row) < 2:
                        continue
                    
                    date_str = row[0].strip()
                    views_str = row[1].strip()
                    
                    # Convert views to integer
                    try:
                        views = int(views_str)
                    except ValueError:
                        views = 0
                    
                    # Insert into page_views_old
                    insert_query = """
                        INSERT INTO page_views_old (problem_name, language, date, views)
                        VALUES (%s, %s, %s, %s)
                    """
                    
                    cursor.execute(insert_query, (PROBLEM_NAME, LANGUAGE, date_str, views))
            
            # Commit the transaction after each file
            conn.commit()

            end_time = time.time()
            elapsed_time = end_time - start_time
            print(f"Time taken to process {filename}: {elapsed_time:.2f} seconds")

    cursor.close()
    conn.close()

if __name__ == "__main__":
    main()

